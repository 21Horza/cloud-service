{"ast":null,"code":"import axios from 'axios';\nimport { setFiles } from '../reducers/fileReducer';\nimport { addFile } from '../reducers/fileReducer';\nexport function getFiles(dirId) {\n  return async dispatch => {\n    try {\n      const response = await axios.get(`http://localhost:5000/api/files${dirId ? '?parent=' + dirId : ''}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport function createDir(dirId, name) {\n  return async dispatch => {\n    try {\n      const response = await axios.post(`http://localhost:5000/api/files`, {\n        name,\n        parent: dirId,\n        type: 'dir'\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport function uploadFile(file, dirId) {\n  return async dispatch => {\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      if (dirId) {\n        formData.append('parent', dirId);\n      }\n\n      const response = await axios.post(`http://localhost:5000/api/files/upload`, formData, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        },\n        onUploadProgress: progressEvent => {\n          const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n          console.log('total', totalLength);\n\n          if (totalLength) {\n            let progress = Math.round(progressEvent.loaded * 100 / totalLength);\n            console.log(progress);\n          }\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport async function downloadFile(file) {\n  const response = await fetch(`http://localhost:5000/api/files/download?id=${file._id}`, {\n    headers: {\n      Authorization: `Bearer ${localStorage.getItem('token')}`\n    }\n  });\n\n  if (response.status === 200) {\n    const blob = await response.blob();\n    const downloadUrl = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = file.name;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  }\n}","map":{"version":3,"sources":["/Users/iliashuianov/projects/js_projects/cloud/client/src/actions/file.js"],"names":["axios","setFiles","addFile","getFiles","dirId","dispatch","response","get","headers","Authorization","localStorage","getItem","data","e","alert","message","createDir","name","post","parent","type","uploadFile","file","formData","FormData","append","onUploadProgress","progressEvent","totalLength","lengthComputable","total","target","getResponseHeader","console","log","progress","Math","round","loaded","downloadFile","fetch","_id","status","blob","downloadUrl","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","remove"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,QAAR,QAAuB,yBAAvB;AACA,SAAQC,OAAR,QAAsB,yBAAtB;AAEA,OAAO,SAASC,QAAT,CAAkBC,KAAlB,EAAyB;AAC5B,SAAO,MAAMC,QAAN,IAAkB;AACrB,QAAI;AACA,YAAMC,QAAQ,GAAG,MAAMN,KAAK,CAACO,GAAN,CAAW,kCAAiCH,KAAK,GAAG,aAAWA,KAAd,GAAsB,EAAG,EAA1E,EAA6E;AAChGI,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD;AADuF,OAA7E,CAAvB;AAGAN,MAAAA,QAAQ,CAACJ,QAAQ,CAACK,QAAQ,CAACM,IAAV,CAAT,CAAR;AACH,KALD,CAKE,OAAOC,CAAP,EAAU;AACRC,MAAAA,KAAK,CAACD,CAAC,CAACP,QAAF,CAAWM,IAAX,CAAgBG,OAAjB,CAAL;AACH;AACJ,GATD;AAUH;AAED,OAAO,SAASC,SAAT,CAAmBZ,KAAnB,EAA0Ba,IAA1B,EAAgC;AACnC,SAAO,MAAMZ,QAAN,IAAkB;AACrB,QAAI;AACA,YAAMC,QAAQ,GAAG,MAAMN,KAAK,CAACkB,IAAN,CAAY,iCAAZ,EAA8C;AACjED,QAAAA,IADiE;AAEjEE,QAAAA,MAAM,EAAEf,KAFyD;AAGjEgB,QAAAA,IAAI,EAAE;AAH2D,OAA9C,EAIpB;AACCZ,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD;AADV,OAJoB,CAAvB;AAOAN,MAAAA,QAAQ,CAACH,OAAO,CAACI,QAAQ,CAACM,IAAV,CAAR,CAAR;AACH,KATD,CASE,OAAOC,CAAP,EAAU;AACRC,MAAAA,KAAK,CAACD,CAAC,CAACP,QAAF,CAAWM,IAAX,CAAgBG,OAAjB,CAAL;AACH;AACJ,GAbD;AAcH;AAED,OAAO,SAASM,UAAT,CAAoBC,IAApB,EAA0BlB,KAA1B,EAAiC;AACpC,SAAO,MAAMC,QAAN,IAAiB;AACpB,QAAI;AACA,YAAMkB,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAD,MAAAA,QAAQ,CAACE,MAAT,CAAgB,MAAhB,EAAwBH,IAAxB;;AACA,UAAIlB,KAAJ,EAAW;AACPmB,QAAAA,QAAQ,CAACE,MAAT,CAAgB,QAAhB,EAA0BrB,KAA1B;AACH;;AACD,YAAME,QAAQ,GAAG,MAAMN,KAAK,CAACkB,IAAN,CAAY,wCAAZ,EAAqDK,QAArD,EAA+D;AACpFf,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD,SAD2E;AAEtFe,QAAAA,gBAAgB,EAAEC,aAAa,IAAI;AAC/B,gBAAMC,WAAW,GAAGD,aAAa,CAACE,gBAAd,GAAiCF,aAAa,CAACG,KAA/C,GAAuDH,aAAa,CAACI,MAAd,CAAqBC,iBAArB,CAAuC,gBAAvC,KAA4DL,aAAa,CAACI,MAAd,CAAqBC,iBAArB,CAAuC,+BAAvC,CAAvI;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBN,WAArB;;AACA,cAAIA,WAAJ,EAAiB;AACb,gBAAIO,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAYV,aAAa,CAACW,MAAd,GAAuB,GAAxB,GAA+BV,WAA1C,CAAf;AACAK,YAAAA,OAAO,CAACC,GAAR,CAAYC,QAAZ;AACH;AACJ;AATqF,OAA/D,CAAvB;AAWA9B,MAAAA,QAAQ,CAACH,OAAO,CAACI,QAAQ,CAACM,IAAV,CAAR,CAAR;AACH,KAlBD,CAkBE,OAAMC,CAAN,EAAS;AACPC,MAAAA,KAAK,CAACD,CAAC,CAACP,QAAF,CAAWM,IAAX,CAAgBG,OAAjB,CAAL;AACH;AACJ,GAtBD;AAuBH;AAED,OAAO,eAAewB,YAAf,CAA4BjB,IAA5B,EAAkC;AACrC,QAAMhB,QAAQ,GAAG,MAAMkC,KAAK,CAAE,+CAA8ClB,IAAI,CAACmB,GAAI,EAAzD,EAA2D;AACnFjC,IAAAA,OAAO,EAAE;AACLC,MAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AADlD;AAD0E,GAA3D,CAA5B;;AAKA,MAAIL,QAAQ,CAACoC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,UAAMC,IAAI,GAAG,MAAMrC,QAAQ,CAACqC,IAAT,EAAnB;AACA,UAAMC,WAAW,GAAGC,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2BJ,IAA3B,CAApB;AACA,UAAMK,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,IAAAA,IAAI,CAACG,IAAL,GAAYP,WAAZ;AACAI,IAAAA,IAAI,CAACI,QAAL,GAAgB9B,IAAI,CAACL,IAArB;AACAgC,IAAAA,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,IAA1B;AACAA,IAAAA,IAAI,CAACO,KAAL;AACAP,IAAAA,IAAI,CAACQ,MAAL;AACH;AACJ","sourcesContent":["import axios from 'axios'\nimport {setFiles} from '../reducers/fileReducer'\nimport {addFile} from '../reducers/fileReducer'\n\nexport function getFiles(dirId) {\n    return async dispatch => {\n        try {\n            const response = await axios.get(`http://localhost:5000/api/files${dirId ? '?parent='+dirId : ''}`, {\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\n            })\n            dispatch(setFiles(response.data))\n        } catch (e) {\n            alert(e.response.data.message)\n        }\n    }\n}\n\nexport function createDir(dirId, name) {\n    return async dispatch => {\n        try {\n            const response = await axios.post(`http://localhost:5000/api/files`, {\n                name,\n                parent: dirId,\n                type: 'dir'\n            }, {\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\n            })\n            dispatch(addFile(response.data))\n        } catch (e) {\n            alert(e.response.data.message)\n        }\n    }\n}\n\nexport function uploadFile(file, dirId) {\n    return async dispatch=> {\n        try {\n            const formData = new FormData()\n            formData.append('file', file)\n            if (dirId) {\n                formData.append('parent', dirId)\n            }\n            const response = await axios.post(`http://localhost:5000/api/files/upload`, formData, {\n              headers: {Authorization: `Bearer ${localStorage.getItem('token')}`},\n            onUploadProgress: progressEvent => {\n                const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n                console.log('total', totalLength)\n                if (totalLength) {\n                    let progress = Math.round((progressEvent.loaded * 100) / totalLength)\n                    console.log(progress)\n                }\n            }\n            })\n            dispatch(addFile(response.data))\n        } catch(e) {\n            alert(e.response.data.message)\n        }\n    }\n}\n\nexport async function downloadFile(file) {\n    const response = await fetch(`http://localhost:5000/api/files/download?id=${file._id}`,{\n        headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n    })\n    if (response.status === 200) {\n        const blob = await response.blob()\n        const downloadUrl = window.URL.createObjectURL(blob)\n        const link = document.createElement('a')\n        link.href = downloadUrl\n        link.download = file.name\n        document.body.appendChild(link)\n        link.click()\n        link.remove()\n    }\n}"]},"metadata":{},"sourceType":"module"}